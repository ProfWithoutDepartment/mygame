<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Уровень 3 - Выбор сложности</title>
    <link rel="stylesheet" href="../common.css">
    <link rel="stylesheet" href="../select-mode.css">
</head>
<body>
    <div class="select-mode-container">
        <div class="mode-card mode-theme-l3">
            <div class="mode-header">
                <h2>Уровень 3: Собери предложения</h2>
                <p>Выберите уровень сложности</p>
            </div>
            
            <div class="level-description">
                <h3>Описание уровня:</h3>
                <p>Соберите 3 предложения из падающих слов. Перетаскивайте слова из нижней области в верхние слоты для составления предложений.</p>
                <ul>
                    <li>3 простых предложения по 3-4 слова</li>
                    <li>Слова падают в нижней области (до 4 одновременно)</li>
                    <li>Перетащите слово в слот для составления предложения</li>
                    <li>Верните слово обратно, перетащив его в нижнюю область</li>
                    <li>Нажмите "Проверить" для проверки предложений</li>
                    <li>Правильное предложение: зеленое, +50 очков</li>
                    <li>Неправильное предложение: красное, -10 очков, ошибка</li>
                    <li>Пустой слот: игнорируется</li>
                </ul>
            </div>
            
            <div class="difficulty-grid" id="difficultyGrid">
                <!-- Сложности будут добавлены через JavaScript -->
            </div>
            
            <button class="start-button" id="startButton" disabled>Начать уровень</button>
            <br>
            <a href="../levels.html" class="back-button">← Назад к выбору уровней</a>
        </div>
    </div>
    
    <script src="../common.js"></script>
    <script>
        const levelNumber = 3;
        
        // Проверка доступа к уровню
        if (typeof checkLevelAccess !== 'undefined' && !checkLevelAccess(levelNumber)) {
            // Если доступ запрещен, скрипт дальше не выполняется
        } else {
            let selectedDifficulty = null;
            
            const difficulties = [
                { id: 'easy', name: 'Простой', icon: 'Easy', color: '#4CAF50' },
                { id: 'medium', name: 'Средний', icon: 'Medium', color: '#FF9800' },
                { id: 'hard', name: 'Сложный', icon: 'Hard', color: '#f44336' }
            ];
            
            const settings = {
                easy: { time: 120, mistakes: 5, multiplier: '×1.0' },
                medium: { time: 90, mistakes: 3, multiplier: '×1.5' },
                hard: { time: 60, mistakes: 1, multiplier: '×2.0' }
            };
            
            const grid = document.getElementById('difficultyGrid');
            
            difficulties.forEach(diff => {
                const setting = settings[diff.id];
                const card = document.createElement('div');
                card.className = `difficulty-card ${diff.id}`;
                card.innerHTML = `
                    <div class="difficulty-icon">${diff.icon}</div>
                    <div class="difficulty-title">${diff.name}</div>
                    <div class="difficulty-stats">
                        <p><strong>Время:</strong> ${setting.time} сек.</p>
                        <p><strong>Ошибки:</strong> ${setting.mistakes}</p>
                        <p><strong>Множитель очков:</strong> ${setting.multiplier}</p>
                    </div>
                `;
                
                card.addEventListener('click', () => {
                    document.querySelectorAll('.difficulty-card').forEach(c => {
                        c.classList.remove('active');
                    });
                    
                    card.classList.add('active');
                    selectedDifficulty = diff.id;
                    
                    document.getElementById('startButton').disabled = false;
                    document.getElementById('startButton').textContent = `Начать уровень (${diff.name})`;
                });
                
                grid.appendChild(card);
            });
            
            document.getElementById('startButton').addEventListener('click', () => {
                if (selectedDifficulty) {
                    if (typeof DifficultyManager !== 'undefined') {
                        DifficultyManager.saveDifficulty(levelNumber, selectedDifficulty);
                    } else {
                        localStorage.setItem(`level${levelNumber}Difficulty`, selectedDifficulty);
                    }
                    
                    window.location.href = 'index3.html';
                }
            });
            
            window.addEventListener('DOMContentLoaded', () => {
                let savedDifficulty;
                if (typeof DifficultyManager !== 'undefined') {
                    savedDifficulty = DifficultyManager.getDifficulty(levelNumber);
                } else {
                    savedDifficulty = localStorage.getItem(`level${levelNumber}Difficulty`) || 'easy';
                }
                
                if (savedDifficulty) {
                    const card = document.querySelector(`.difficulty-card.${savedDifficulty}`);
                    if (card) {
                        card.click();
                    }
                }
            });
        }
    </script>
</body>
</html>